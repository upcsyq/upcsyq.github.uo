---
layout: default
title: 你好，世界
---
<h2>{{ page.title }}</h2>
<p>同事反馈，在华为honor 6手机上，打开某网页容易出现转圈动画不消失，页面无法显示的问题</p>
<p>有问题嘛，正常，先试图重现分析。</p>
<p>第一步，找到honor 6，试图重现该问题。把手机拿过来试了一把，
咳咳，确实容易出现。恩，需要静一静，这个是生产版本，貌似客户端没有什么有用的日志。</p>
<p>第二步，安装一个带日志的生产版本，看看有什么发现，咳咳，发现进度值要么是0，要么是90，就是没有100，
分析代码，这个转圈动画要在页面加载结束的时候才消失，哦哦，可以解释动画为什么一直在了。那该怎么让动画消失呢？
因为webview的兼容性问题，通常不建议单独使用加载动画，可以使用进度条。查阅资料，有人提到在第一次绘制的时候（
即设置pictureListener，重载相关接口)，让动画消失，貌似也是合理的，有待验证。还有一个问题呢？页面无法显示呢？
首先想到的是，用chrome inspect看看，首先看主资源是否都在，比较悲催的是，看到的主资源没有body，为什么呢？为什么呢？
暂时无法解释，所以想到在服务器抓包看看，为是否因为网站服务器吐的页面不全呢？其次，在客户端增加更多的日志，看看
是否在拉取主资源过程中出错了。从日志也看不出什么问题来，咋办，咳咳，静一静，可以抓包（android抓包，手机端抓包和服务器抓包）</p>
<p>第三步，分析Android抓包，在手机root情况下，用tcpdump抓包，用wireshark打开，发现css和js都收到服务器返回的206，,206是什么鬼？
只怪俺http没有学习好，查阅资料，发现是因为客户端使用了range和if-range，然后服务器发现资源没有变化，所以返回了206。
为什么要用range相关的东西呢？查阅资料，发现是因为认为css是大文件，客户端缓存了部分，期望把该部分所属的整个文件一起缓存下来，
一起缓存起来，还会有网络请求么？</p>
<p>额外补充一点，这个网页是用react js实现的，页面的展示需要强制依赖某一个js组件文件，如果这个文件没有拉去到或者缓存有问题，
那么对不起，页面有可能展示不出来</p>
<p>{{ page.date | date_to_string }}</p>